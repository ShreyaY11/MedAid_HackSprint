{% extends 'base.html' %}

{% block title %}Register Patient - MedAid{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .section-header {
        color: #4f46e5;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e5e7eb;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div style="max-width: 700px; margin: 2rem auto;">
        <div class="form-section">
            <div class="text-center mb-4">
                <i class="bi bi-person-plus-fill" style="font-size: 3rem; color: #4f46e5;"></i>
                <h2 class="mt-3 mb-2">Register New Patient</h2>
                <p class="text-muted">Create a patient account and health profile</p>
            </div>
            
            <form method="post" action="{% url 'register_patient' %}">
                {% csrf_token %}
                
                <!-- Personal Information Section -->
                <h5 class="section-header">
                    <i class="bi bi-person-badge"></i> Personal Information
                </h5>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="bi bi-person"></i> First Name *
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="text-danger small">{{ form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="bi bi-person"></i> Last Name *
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div class="text-danger small">{{ form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">
                        <i class="bi bi-person-circle"></i> Username *
                    </label>
                    {{ form.username }}
                    <small class="form-text text-muted">
                        Patient will use this username to login
                    </small>
                    {% if form.username.errors %}
                        <div class="text-danger small">{{ form.username.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="bi bi-envelope"></i> Email Address
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="text-danger small">{{ form.email.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            <i class="bi bi-telephone"></i> Phone Number *
                        </label>
                        {{ form.phone_number }}
                        {% if form.phone_number.errors %}
                            <div class="text-danger small">{{ form.phone_number.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Medical Information Section -->
                <h5 class="section-header mt-4">
                    <i class="bi bi-heart-pulse"></i> Basic Health Information
                </h5>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">
                            <i class="bi bi-calendar3"></i> Age *
                        </label>
                        {{ form.age }}
                        {% if form.age.errors %}
                            <div class="text-danger small">{{ form.age.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label class="form-label">
                            <i class="bi bi-gender-ambiguous"></i> Gender
                        </label>
                        {{ form.gender }}
                        {% if form.gender.errors %}
                            <div class="text-danger small">{{ form.gender.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label class="form-label">
                            <i class="bi bi-calendar-date"></i> Date of Birth
                        </label>
                        {{ form.date_of_birth }}
                        {% if form.date_of_birth.errors %}
                            <div class="text-danger small">{{ form.date_of_birth.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Login Credentials Section -->
                <h5 class="section-header mt-4">
                    <i class="bi bi-lock"></i> Login Credentials
                </h5>
                
                <div class="mb-3">
                    <label class="form-label">
                        <i class="bi bi-key"></i> Password *
                    </label>
                    {{ form.password }}
                    <small class="form-text text-muted">
                        Create a secure password for the patient (minimum 8 characters)
                    </small>
                    {% if form.password.errors %}
                        <div class="text-danger small">{{ form.password.errors }}</div>
                    {% endif %}
                </div>
                
                <!-- Alert Box -->
                <div class="alert alert-info mt-4">
                    <i class="bi bi-info-circle-fill"></i>
                    <strong>Note:</strong> After registration, you'll be able to record symptoms for this patient immediately.
                </div>
                
                <!-- Action Buttons -->
                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle-fill"></i> Register Patient
                    </button>
                    <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-focus on first name field
    document.addEventListener('DOMContentLoaded', function() {
        const firstNameInput = document.querySelector('input[name="first_name"]');
        if (firstNameInput) {
            firstNameInput.focus();
        }
    });
    
    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const requiredFields = ['first_name', 'last_name', 'username', 'phone_number', 'age', 'password'];
        let isValid = true;
        
        requiredFields.forEach(function(fieldName) {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field && !field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
            } else if (field) {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all required fields (marked with *)');
        }
    });
</script>
{% endblock %}
